<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Кафе</title>
  <style>
    body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background: #fafafa; }
    header {
      background: #d35400;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: 1.5px;
      user-select: none;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background: #f3f3f3;
      box-shadow: inset 0 -2px 0 #d35400;
    }
    .tab-button {
      padding: 1rem 2rem;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1.1rem;
      color: #555;
      font-weight: 600;
      transition: color 0.3s, border-bottom 0.3s;
      border-bottom: 3px solid transparent;
    }
    .tab-button:hover {
      color: #d35400;
    }
    .tab-button.active {
      color: #d35400;
      font-weight: 700;
      border-bottom: 3px solid #d35400;
    }
    #search-bar {
      display: flex;
      justify-content: center;
      padding: 0.8rem 1rem;
      background: white;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.05);
    }
    #search-input {
      width: 100%;
      max-width: 400px;
      padding: 0.6rem 1rem;
      font-size: 1.1rem;
      border-radius: 25px;
      border: 1.5px solid #d35400;
      outline: none;
      transition: border-color 0.3s;
    }
    #search-input:focus {
      border-color: #e67e22;
      box-shadow: 0 0 8px #e67e22aa;
    }
    #menu {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
      padding: 1rem 1.5rem 4rem;
    }
    .menu-item {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
      display: flex;
      flex-direction: column;
      user-select: none;
      transition: transform 0.2s ease;
    }
    .menu-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }
    .menu-item img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-bottom: 1.5px solid #eee;
    }
    .menu-item div {
      padding: 0.7rem 1rem 1rem;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .menu-name {
      font-weight: 700;
      font-size: 1.15rem;
      margin-bottom: 0.4rem;
      color: #333;
    }
    .menu-price {
      font-weight: 600;
      color: #d35400;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    .menu-controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .menu-controls input {
      width: 50px;
      padding: 0.25rem 0.5rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1.2px solid #ccc;
      text-align: center;
      user-select: text;
    }
    .menu-controls button {
      flex-grow: 1;
      padding: 0.4rem 0.8rem;
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    .menu-controls button:hover {
      background: #219150;
    }
    #order-summary {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: white;
      box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.1);
      padding: 1rem 1.5rem;
      display: none;
      user-select: none;
      z-index: 1000;
    }
    #order-summary ul {
      list-style: none;
      padding: 0;
      margin: 0 0 0.7rem 0;
      max-height: 130px;
      overflow-y: auto;
    }
    #order-summary li {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.4rem;
      font-weight: 600;
      color: #333;
    }
    #order-summary button {
      padding: 0.5rem 1.2rem;
      margin-right: 0.5rem;
      border: none;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s;
    }
    #clear-order {
      background: #c0392b;
      color: white;
    }
    #clear-order:hover {
      background: #962d22;
    }
    #submit-order {
      background: #2980b9;
      color: white;
    }
    #submit-order:hover {
      background: #1f5c86;
    }
    #modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.55);
      justify-content: center;
      align-items: center;
      z-index: 1100;
    }
    #modal-content {
      background: white;
      padding: 2rem 2.5rem;
      border-radius: 12px;
      width: 320px;
      max-width: 90%;
      text-align: center;
      position: relative;
      box-shadow: 0 5px 25px rgba(0,0,0,0.15);
    }
    #modal-content h3 {
      margin-bottom: 1.2rem;
      font-weight: 700;
      color: #d35400;
      user-select: text;
    }
    #modal-content input {
      width: 100%;
      padding: 0.5rem 1rem;
      margin: 0.6rem 0;
      font-size: 1rem;
      border-radius: 8px;
      border: 1.4px solid #ccc;
      outline: none;
      transition: border-color 0.3s;
    }
    #modal-content input:focus {
      border-color: #d35400;
      box-shadow: 0 0 8px #d35400aa;
    }
    #modal-content button {
      margin-top: 1.2rem;
      width: 100%;
      padding: 0.6rem 0;
      font-weight: 700;
      font-size: 1.1rem;
      border-radius: 10px;
      border: none;
      background: #27ae60;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }
    #modal-content button:hover {
      background: #1e8449;
    }
    #modal-close {
      position: absolute;
      top: 12px;
      right: 15px;
      font-size: 1.5rem;
      color: #999;
      cursor: pointer;
      user-select: none;
      transition: color 0.2s;
    }
    #modal-close:hover {
      color: #d35400;
    }
  </style>
</head>
<body>
  <header>Меню Кафе</header>
  <div class="tabs">
    <button class="tab-button active" data-category="bar">Бар</button>
    <button class="tab-button" data-category="kitchen">Кухня</button>
    <button class="tab-button" data-category="desserts">Десерты</button>
  </div>
  <div id="search-bar">
    <input type="text" id="search-input" placeholder="Поиск по меню..." />
  </div>
  <div id="menu"></div>

  <div id="order-summary">
    <ul id="order-items"></ul>
    <div id="order-total" style="font-weight:700; margin-bottom:0.6rem;"></div>
    <div>
      <button id="clear-order">Очистить</button>
      <button id="submit-order">Оформить заказ</button>
    </div>
  </div>

  <div id="modal">
    <div id="modal-content">
      <div id="modal-close">&times;</div>
      <h3>Ваши данные</h3>
      <input type="text" id="customer-name" placeholder="Имя" autocomplete="name" />
      <input type="tel" id="customer-phone" placeholder="Телефон (+7XXXXXXXXXX)" autocomplete="tel" pattern="[\+0-9]{10,15}" />
      <button id="confirm-order">Подтвердить заказ</button>
    </div>
  </div>

  <script>
    const menu = [
      { id: 1, category: 'bar', name: 'Капучино', price: 150, image: 'https://i.postimg.cc/bwD3vVbt/image.jpg' },
      { id: 2, category: 'bar', name: 'Латте', price: 170, image: 'https://i.postimg.cc/RF9RXMY7/image.jpg' },
      { id: 3, category: 'kitchen', name: 'Цезарь', price: 350, image: 'https://i.postimg.cc/3xFCWMNW/image.jpg' },
      { id: 4, category: 'kitchen', name: 'Паста', price: 420, image: 'https://i.postimg.cc/CMnGkn53/image.jpg' },
      { id: 5, category: 'desserts', name: 'Чизкейк', price: 250, image: 'https://i.postimg.cc/MG00cCGv/image.jpg' },
      { id: 6, category: 'desserts', name: 'Мороженое', price: 150, image: 'https://i.postimg.cc/vm95SmQm/image.jpg' },
      { id: 7, category: 'bar', name: 'Кола 0,5', price: 120, image: 'https://i.postimg.cc/yYqFP6Sk/image.jpg' },
      { id: 8, category: 'bar', name: 'RedBull 0,5', price: 180, image: 'https://i.postimg.cc/0ynDPpXw/image.jpg' },
      { id: 9, category: 'kitchen', name: 'Шаурма', price: 210, image: 'https://i.postimg.cc/fLG0B5y6/image.webp' }
    ];

    const menuDiv = document.getElementById('menu');
    const buttons = document.querySelectorAll('.tab-button');
    const orderSummary = document.getElementById('order-summary');
    const orderItemsList = document.getElementById('order-items');
    const orderTotalDiv = document.getElementById('order-total');
    const clearOrderBtn = document.getElementById('clear-order');
    const submitOrderBtn = document.getElementById('submit-order');
    const confirmOrderBtn = document.getElementById('confirm-order');
    const searchInput = document.getElementById('search-input');
    const modal = document.getElementById('modal');
    const modalCloseBtn = document.getElementById('modal-close');

    let order = JSON.parse(localStorage.getItem('order')) || {};
    let currentCategory = 'bar';

    function saveOrder() {
      localStorage.setItem('order', JSON.stringify(order));
    }

    function updateOrderSummary() {
      const items = Object.values(order);
      if (items.length === 0) {
        orderSummary.style.display = 'none';
        return;
      }
      orderSummary.style.display = 'block';
      orderItemsList.innerHTML = '';
      let total = 0;
      items.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item.name} x${item.quantity}`;
        const priceSpan = document.createElement('span');
        priceSpan.textContent = `${item.price * item.quantity}₽`;
        li.appendChild(priceSpan);
        orderItemsList.appendChild(li);
        total += item.price * item.quantity;
      });
      orderTotalDiv.textContent = `Итого: ${total}₽`;
    }

    function renderMenu(category, search = '') {
      currentCategory = category;
      menuDiv.innerHTML = '';
      const filtered = menu.filter(
        item =>
          item.category === category &&
          item.name.toLowerCase().includes(search.toLowerCase())
      );
      filtered.forEach(item => {
        const div = document.createElement('div');
        div.className = 'menu-item';
        div.innerHTML = `
          <img src="${item.image}" alt="${item.name}" />
          <div>
            <div class="menu-name">${item.name}</div>
            <div class="menu-price">${item.price} ₽</div>
            <div class="menu-controls">
              <input type="number" value="1" min="1" />
              <button>Добавить</button>
            </div>
          </div>
        `;
        const qtyInput = div.querySelector('input');
        const addBtn = div.querySelector('button');
        addBtn.addEventListener('click', () => {
          const qty = parseInt(qtyInput.value);
          if (qty < 1 || isNaN(qty)) return;
          if (order[item.id]) {
            order[item.id].quantity += qty;
          } else {
            order[item.id] = {
              id: item.id,
              name: item.name,
              price: item.price,
              quantity: qty
            };
          }
          saveOrder();
          updateOrderSummary();
        });
        menuDiv.appendChild(div);
      });
    }

    buttons.forEach(button => {
      button.addEventListener('click', () => {
        buttons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        renderMenu(button.dataset.category, searchInput.value);
      });
    });

    searchInput.addEventListener('input', () => {
      renderMenu(currentCategory, searchInput.value);
    });

    clearOrderBtn.addEventListener('click', () => {
      if (confirm('Очистить весь заказ?')) {
        order = {};
        saveOrder();
        updateOrderSummary();
      }
    });

    submitOrderBtn.addEventListener('click', () => {
      if (Object.keys(order).length === 0) {
        alert('Ваш заказ пуст.');
        return;
      }
      // Показать модальное окно
      modal.style.display = 'flex';
      document.getElementById('customer-name').focus();
    });

    modalCloseBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    confirmOrderBtn.addEventListener('click', () => {
      const name = document.getElementById('customer-name').value.trim();
      const phone = document.getElementById('customer-phone').value.trim();
      if (!name) {
        alert('Пожалуйста, введите имя.');
        return;
      }
      const phoneRegex = /^\+?\d{10,15}$/;
      if (!phoneRegex.test(phone)) {
        alert('Пожалуйста, введите корректный телефон.');
        return;
      }
      // Формируем текст заказа
      let orderText = `Новый заказ:\nИмя: ${name}\nТелефон: ${phone}\n\nЗаказ:\n`;
      let total = 0;
      for (const key in order) {
        const item = order[key];
        orderText += `${item.name} x${item.quantity} — ${item.price * item.quantity}₽\n`;
        total += item.price * item.quantity;
      }
      orderText += `\nИтого: ${total}₽`;

      // Здесь отправка заказа в Telegram или куда нужно
      // Пока просто выводим alert
      alert(orderText);

      // Очистка заказа и закрытие модального окна
      order = {};
      saveOrder();
      updateOrderSummary();
      modal.style.display = 'none';

      // Можно здесь вызвать отправку на сервер или Telegram-бота
    });

    // Инициализация
    renderMenu(currentCategory);
    updateOrderSummary();
  </script>
</body>
</html>
