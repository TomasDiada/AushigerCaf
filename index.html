<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Кафе - Меню</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #fafafa;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    header {
      background: #d35400;
      color: white;
      padding: 1rem;
      font-size: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      font-weight: bold;
    }

    .header-right a {
      color: white;
      text-decoration: none;
      font-size: 1rem;
    }

    .phone-number {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: white;
      text-decoration: none;
      font-size: 1rem;
    }
    .close-button {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 22px;
      background: transparent;
      border: none;
      color: #333;
      cursor: pointer;
      transition: color 0.2s ease;
      z-index: 1000;
    }

    .close-button:hover {
        color: red;
    }
    #search-bar {
      padding: 0.5rem 1rem;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    #modal-content {
      position: relative;
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 300px;
    }
    #search-input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      outline-offset: 2px;
      outline-color: #d35400;
    }
    .category {
      margin: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .category-header {
      background: #f3f3f3;
      padding: 0.8rem 1rem;
      font-weight: 600;
      font-size: 1.2rem;
      color: #d35400;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }
    .category-header:hover {
      background: #e67e22;
      color: white;
    }
    .category-header .arrow {
      transition: transform 0.3s ease;
    }
    .category-header.collapsed .arrow {
      transform: rotate(-90deg);
    }
    .items-list {
      max-height: 1000px; /* large to show all */
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .items-list.collapsed {
      max-height: 0;
      padding: 0;
      transition: max-height 0.3s ease, padding 0.3s ease;
    }
    .menu-item {
      display: flex;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      border-top: 1px solid #eee;
      align-items: center;
    }
    .menu-item:first-child {
      border-top: none;
    }
    .menu-item img {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 10px;
      flex-shrink: 0;
      background: #ddd;
    }
    .menu-info {
      flex-grow: 1;
    }
    .menu-name {
      font-weight: 600;
      font-size: 1.05rem;
      margin-bottom: 0.2rem;
    }
    .menu-price {
      color: #555;
      font-size: 0.9rem;
    }
    .menu-controls {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .menu-controls input {
      width: 50px;
      padding: 0.3rem 0.5rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      text-align: center;
      outline-offset: 2px;
      outline-color: #d35400;
    }
    .menu-controls button {
      padding: 0.3rem 0.8rem;
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .menu-controls button:hover {
      background: #219150;
    }
    #order-summary {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      padding: 1rem;
      display: none;
      z-index: 100;
    }
    #order-summary ul {
      list-style: none;
      padding: 0;
      margin: 0 0 0.5rem 0;
      max-height: 120px;
      overflow-y: auto;
    }
    #order-summary li {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.3rem;
      font-size: 0.95rem;
    }
    #order-summary button {
      padding: 0.5rem 1rem;
      margin-right: 0.5rem;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }
    #clear-order {
      background: #c0392b;
      color: white;
      transition: background-color 0.3s ease;
    }
    #clear-order:hover {
      background: #a83223;
    }
    #submit-order {
      background: #2980b9;
      color: white;
      transition: background-color 0.3s ease;
    }
    #submit-order:hover {
      background: #21628c;
    }
    /* Modal */
    #modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 200;
    }
    #modal-content {
      background: white;
      padding: 2rem 1.5rem;
      border-radius: 12px;
      width: 90%;
      max-width: 350px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      user-select: none;
      position: relative;
    }
    #modal-content h3 {
      margin-bottom: 1rem;
      color: #d35400;
    }
    #modal-content input {
      width: 100%;
      padding: 0.6rem 0.8rem;
      margin: 0.5rem 0;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      outline-offset: 2px;
      outline-color: #d35400;
    }
    #modal-content button {
      margin-top: 1rem;
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1.2rem;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
      width: 100%;
    }
    #modal-content button:hover {
      background: #219150;
    }
    #modal-close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 22px;
      background: transparent;
      border: none;
      color: #333;
      cursor: pointer;
      transition: color 0.2s ease;
      user-select: none;
    }
    #modal-close-btn:hover {
      color: red;
    }
    /* Scrollbar for order summary */
    #order-summary ul::-webkit-scrollbar {
      width: 6px;
    }
    #order-summary ul::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-left">Кафе "Вкусняшка"</div>
    <a href="tel:+1234567890" class="phone-number">+1 234 567 890</a>
  </header>

  <div id="search-bar">
    <input id="search-input" type="text" placeholder="Поиск блюд..." aria-label="Поиск блюд" />
  </div>

  <main id="menu"></main>

  <div id="order-summary" aria-live="polite" aria-label="Сводка заказа">
    <ul id="order-items"></ul>
    <div style="text-align: right;">
      <button id="clear-order" aria-label="Очистить заказ">Очистить</button>
      <button id="submit-order" aria-label="Оформить заказ">Оформить заказ</button>
    </div>
  </div>

  <!-- Модальное окно для ввода данных -->
  <div id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div id="modal-content">
      <button id="modal-close-btn" aria-label="Закрыть">&times;</button>
      <h3 id="modal-title">Оформление заказа</h3>
      <input type="text" id="customer-name" placeholder="Ваше имя" aria-required="true" />
      <input type="tel" id="customer-phone" placeholder="Телефон" aria-required="true" />
      <button id="confirm-order">Подтвердить заказ</button>
    </div>
  </div>

  <script>
    const menuData = [
      {
        category: "Пицца",
        items: [
          {
            id: "pizza_margherita",
            name: "Маргарита",
            description: "Томатный соус, моцарелла, базилик",
            price: 450,
            image: "https://cdn-icons-png.flaticon.com/512/2232/2232688.png"
          },
          {
            id: "pizza_pepperoni",
            name: "Пепперони",
            description: "Пицца с пепперони и сыром",
            price: 550,
            image: "https://cdn-icons-png.flaticon.com/512/2232/2232688.png"
          },
        ]
      },
      {
        category: "Напитки",
        items: [
          {
            id: "cola_0.3",
            name: "Кола 0.3л",
            price: 50,
            image: "https://cdn-icons-png.flaticon.com/512/3134/3134790.png"
          },
          {
            id: "cola_0.5",
            name: "Кола 0.5л",
            price: 80,
            image: "https://cdn-icons-png.flaticon.com/512/3134/3134790.png"
          }
        ]
      }
    ];

    const menuContainer = document.getElementById("menu");
    const searchInput = document.getElementById("search-input");
    const orderSummary = document.getElementById("order-summary");
    const orderItemsContainer = document.getElementById("order-items");
    const clearOrderBtn = document.getElementById("clear-order");
    const submitOrderBtn = document.getElementById("submit-order");

    const modal = document.getElementById("modal");
    const modalCloseBtn = document.getElementById("modal-close-btn");
    const confirmOrderBtn = document.getElementById("confirm-order");
    const customerNameInput = document.getElementById("customer-name");
    const customerPhoneInput = document.getElementById("customer-phone");

    let order = JSON.parse(localStorage.getItem("order")) || {};

    function saveOrder() {
      localStorage.setItem("order", JSON.stringify(order));
    }

    function createMenuItem(item) {
      const div = document.createElement("div");
      div.className = "menu-item";
      div.setAttribute("tabindex", "0");

      div.innerHTML = `
        <img src="${item.image}" alt="${item.name}" />
        <div class="menu-info">
          <div class="menu-name">${item.name}</div>
          <div class="menu-price">${item.price} ₽</div>
        </div>
        <div class="menu-controls">
          <input type="number" min="1" value="1" aria-label="Количество ${item.name}" />
          <button aria-label="Добавить ${item.name} в заказ">Добавить</button>
        </div>
      `;

      const qtyInput = div.querySelector("input");
      const addButton = div.querySelector("button");

      addButton.addEventListener("click", () => {
        let qty = parseInt(qtyInput.value);
        if (isNaN(qty) || qty < 1) {
          alert("Пожалуйста, введите корректное количество.");
          qtyInput.value = "1";
          return;
        }

        if (order[item.id]) {
          order[item.id].quantity += qty;
        } else {
          order[item.id] = {
            ...item,
            quantity: qty
          };
        }
        saveOrder();
        updateOrderSummary();
      });

      return div;
    }

    function renderMenu(filter = "") {
      menuContainer.innerHTML = "";
      menuData.forEach(category => {
        const categorySection = document.createElement("section");
        categorySection.className = "category";

        const header = document.createElement("div");
        header.className = "category-header";
        header.textContent = category.category;

        const arrow = document.createElement("span");
        arrow.className = "arrow";
        arrow.textContent = "▶";
        header.appendChild(arrow);

        const itemsList = document.createElement("div");
        itemsList.className = "items-list";

        // Фильтрация по названию
        const filteredItems = category.items.filter(item =>
          item.name.toLowerCase().includes(filter.toLowerCase())
        );

        filteredItems.forEach(item => {
          itemsList.appendChild(createMenuItem(item));
        });

        categorySection.appendChild(header);
        categorySection.appendChild(itemsList);
        menuContainer.appendChild(categorySection);

        // Коллапсирование категории по клику
        header.addEventListener("click", () => {
          itemsList.classList.toggle("collapsed");
          header.classList.toggle("collapsed");
        });
      });
    }

    function updateOrderSummary() {
      orderItemsContainer.innerHTML = "";

      if (Object.keys(order).length === 0) {
        orderSummary.style.display = "none";
        return;
      }

      orderSummary.style.display = "block";

      Object.values(order).forEach(item => {
        const li = document.createElement("li");

        // Создаём кнопки для уменьшения, увеличения и удаления
        const minusBtn = document.createElement("button");
        minusBtn.textContent = "-";
        minusBtn.setAttribute("aria-label", `Уменьшить количество ${item.name}`);
        minusBtn.style.marginRight = "5px";

        const plusBtn = document.createElement("button");
        plusBtn.textContent = "+";
        plusBtn.setAttribute("aria-label", `Увеличить количество ${item.name}`);
        plusBtn.style.marginLeft = "5px";

        const removeBtn = document.createElement("button");
        removeBtn.textContent = "×";
        removeBtn.setAttribute("aria-label", `Удалить ${item.name} из заказа`);
        removeBtn.style.marginLeft = "10px";
        removeBtn.style.color = "red";
        removeBtn.style.background = "none";
        removeBtn.style.border = "none";
        removeBtn.style.fontSize = "18px";
        removeBtn.style.cursor = "pointer";
        removeBtn.style.padding = "0";

        li.textContent = `${item.name} - ${item.price} ₽ × ${item.quantity} = ${item.price * item.quantity} ₽`;

        // Вставляем кнопки в li
        const controlsSpan = document.createElement("span");
        controlsSpan.style.marginLeft = "10px";
        controlsSpan.appendChild(minusBtn);
        controlsSpan.appendChild(plusBtn);
        controlsSpan.appendChild(removeBtn);

        li.appendChild(controlsSpan);

        orderItemsContainer.appendChild(li);

        minusBtn.addEventListener("click", () => {
          if (item.quantity > 1) {
            item.quantity--;
          } else {
            delete order[item.id];
          }
          saveOrder();
          updateOrderSummary();
        });

        plusBtn.addEventListener("click", () => {
          item.quantity++;
          saveOrder();
          updateOrderSummary();
        });

        removeBtn.addEventListener("click", () => {
          delete order[item.id];
          saveOrder();
          updateOrderSummary();
        });
      });
    }

    clearOrderBtn.addEventListener("click", () => {
      if (confirm("Очистить весь заказ?")) {
        order = {};
        saveOrder();
        updateOrderSummary();
      }
    });

    submitOrderBtn.addEventListener("click", () => {
      if (Object.keys(order).length === 0) {
        alert("Заказ пуст. Пожалуйста, добавьте товары.");
        return;
      }
      modal.style.display = "flex";
      customerNameInput.focus();
    });

    modalCloseBtn.addEventListener("click", () => {
      modal.style.display = "none";
    });

    // Закрытие модального окна при клике вне контента
    modal.addEventListener("click", (e) => {
      if (e.target === modal) {
        modal.style.display = "none";
      }
    });

    confirmOrderBtn.addEventListener("click", () => {
      const name = customerNameInput.value.trim();
      const phone = customerPhoneInput.value.trim();

      if (!name || !phone) {
        alert("Пожалуйста, заполните имя и телефон.");
        return;
      }

      // Здесь можно отправить заказ на сервер или обработать иначе
      alert(`Спасибо за заказ, ${name}! Мы свяжемся с вами по телефону ${phone}.`);

      // Очистка и закрытие
      order = {};
      saveOrder();
      updateOrderSummary();
      customerNameInput.value = "";
      customerPhoneInput.value = "";
      modal.style.display = "none";
    });

    searchInput.addEventListener("input", () => {
      renderMenu(searchInput.value);
    });

    // Инициализация
    renderMenu();
    updateOrderSummary();
  </script>
</body>
</html>
