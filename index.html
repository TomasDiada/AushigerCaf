<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Кафе</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    background: #fefefe;
    color: #333;
  }
  header {
    background: #e67e22;
    color: white;
    padding: 1rem;
    text-align: center;
    font-size: 1.7rem;
    font-weight: 700;
    letter-spacing: 1.5px;
    box-shadow: 0 3px 8px rgba(230, 126, 34, 0.5);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  #search-bar {
    background: #fff;
    padding: 0.8rem 1rem;
    position: sticky;
    top: 60px;
    z-index: 90;
    box-shadow: 0 2px 6px rgba(0,0,0,0.07);
  }
  #search-input {
    width: 100%;
    max-width: 480px;
    padding: 0.55rem 1rem;
    font-size: 1.1rem;
    border-radius: 25px;
    border: 1.8px solid #e67e22;
    outline-offset: 2px;
    transition: border-color 0.3s ease;
    box-sizing: border-box;
  }
  #search-input:focus {
    border-color: #d35400;
    box-shadow: 0 0 8px rgba(211, 84, 0, 0.5);
  }
  #menu {
    padding: 1rem 1.5rem 4rem 1.5rem;
    max-width: 600px;
    margin: auto;
  }
  .category {
    margin-bottom: 2rem;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 12px rgba(0,0,0,0.05);
    background: white;
    transition: box-shadow 0.3s ease;
  }
  .category:hover {
    box-shadow: 0 8px 20px rgba(230, 126, 34, 0.3);
  }
  .category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.9rem 1.3rem;
    font-weight: 700;
    font-size: 1.3rem;
    cursor: pointer;
    user-select: none;
    color: white;
  }
  /* Цвета заголовков по категориям */
  .category-header.kitchen {
    background: linear-gradient(45deg, #f39c12, #d35400);
    box-shadow: inset 0 -3px 6px rgba(0,0,0,0.15);
  }
  .category-header.desserts {
    background: linear-gradient(45deg, #e84393, #d63031);
    box-shadow: inset 0 -3px 6px rgba(0,0,0,0.15);
  }
  .category-header.bar {
    background: linear-gradient(45deg, #0984e3, #6c5ce7);
    box-shadow: inset 0 -3px 6px rgba(0,0,0,0.15);
  }

  .toggle-icon {
    font-weight: 700;
    font-size: 1.4rem;
    transition: transform 0.4s ease;
    user-select: none;
    color: rgba(255,255,255,0.85);
    line-height: 1;
  }
  .category.collapsed .toggle-icon {
    transform: rotate(-90deg);
  }
  .category.collapsed .category-items {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease, padding 0.3s ease;
    padding: 0 1.3rem;
  }
  .category-items {
    padding: 1rem 1.3rem 1.3rem 1.3rem;
    max-height: 2000px; /* достаточно для плавного сворачивания */
    overflow: hidden;
    transition: max-height 0.5s ease, padding 0.3s ease;
  }
  .menu-item {
    display: flex;
    align-items: center;
    background: #fff8f0;
    border-radius: 8px;
    box-shadow: 0 1px 6px rgba(230,126,34,0.15);
    margin: 0.5rem 0;
    padding: 0.55rem 0.9rem;
    transition: box-shadow 0.25s ease;
  }
  .menu-item:hover {
    box-shadow: 0 5px 15px rgba(230,126,34,0.3);
  }
  .menu-item img {
    width: 70px;
    height: 52px;
    object-fit: cover;
    border-radius: 10px;
    margin-right: 1rem;
    flex-shrink: 0;
    border: 2px solid #f39c12;
  }
  .menu-info {
    flex-grow: 1;
  }
  .menu-name {
    font-weight: 700;
    margin-bottom: 0.2rem;
    color: #d35400;
  }
  .menu-price {
    color: #7f8c8d;
    font-weight: 600;
  }
  .menu-controls {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    margin-left: 1rem;
  }
  .menu-controls input {
    width: 52px;
    padding: 0.4rem;
    font-size: 1rem;
    text-align: center;
    border: 1.5px solid #d35400;
    border-radius: 8px;
    outline-offset: 1px;
    transition: border-color 0.3s ease;
  }
  .menu-controls input:focus {
    border-color: #e67e22;
    box-shadow: 0 0 6px rgba(230,126,34,0.5);
  }
  .menu-controls button {
    padding: 0.4rem 1rem;
    background: #d35400;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 700;
    letter-spacing: 0.8px;
    transition: background 0.3s ease;
  }
  .menu-controls button:hover {
    background: #e67e22;
  }
  #order-summary {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #fff;
    box-shadow: 0 -2px 12px rgba(0,0,0,0.15);
    padding: 1rem 1.3rem;
    display: none;
    box-sizing: border-box;
    max-height: 40vh;
    overflow-y: auto;
    z-index: 110;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    border-top-left-radius: 15px;
    border-top-right-radius: 15px;
  }
  #order-items {
    list-style: none;
    padding: 0;
    margin: 0 0 0.8rem 0;
    max-height: 150px;
    overflow-y: auto;
  }
  #order-items li {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.35rem;
    font-size: 1rem;
    border-bottom: 1px solid #eee;
    padding-bottom: 0.25rem;
  }
  #order-total {
    font-weight: 800;
    margin-bottom: 0.6rem;
    font-size: 1.15rem;
    text-align: right;
    color: #d35400;
  }
  #order-summary button {
    padding: 0.55rem 1.2rem;
    margin-right: 0.6rem;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 700;
    letter-spacing: 0.7px;
    transition: background 0.3s ease;
  }
  #clear-order {
    background: #c0392b;
    color: white;
  }
  #clear-order:hover {
    background: #e74c3c;
  }
  #submit-order {
    background: #2980b9;
    color: white;
  }
  #submit-order:hover {
    background: #3498db;
  }
  #modal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.48);
    justify-content: center;
    align-items: center;
    z-index: 120;
  }
  #modal-content {
    background: white;
    padding: 2rem 2.5rem;
    border-radius: 15px;
    width: 90%;
    max-width: 360px;
    box-sizing: border-box;
    text-align: center;
    box-shadow: 0 6px 24px rgba(0,0,0,0.15);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  #modal-content h3 {
    margin-bottom: 1rem;
    color: #d35400;
    font-weight: 800;
    font-size: 1.4rem;
  }
  #modal-content input {
    width: 100%;
    padding: 0.65rem 1rem;
    margin: 0.55rem 0 1.2rem 0;
    font-size: 1.1rem;
    border-radius: 10px;
    border: 1.8px solid #d35400;
    outline-offset: 2px;
    transition: border-color 0.3s ease;
    box-sizing: border-box;
  }
  #modal-content input:focus {
    border-color: #e67e22;
    box-shadow: 0 0 8px rgba(230,126,34,0.5);
  }
  #modal-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
  }
  #modal-buttons button {
    padding: 0.65rem 1.5rem;
    font-weight: 700;
    letter-spacing: 0.8px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #modal-submit {
    background: #27ae60;
    color: white;
  }
  #modal-submit:hover {
    background: #2ecc71;
  }
  #modal-cancel {
    background: #c0392b;
    color: white;
  }
  #modal-cancel:hover {
    background: #e74c3c;
  }
  @media (max-width: 520px) {
    #menu {
      padding: 1rem 1rem 3rem 1rem;
    }
    .menu-item img {
      width: 60px;
      height: 44px;
    }
    .menu-controls input {
      width: 44px;
    }
  }
</style>
</head>
<body>

<header>Меню Кафе</header>

<div id="search-bar">
  <input type="search" id="search-input" placeholder="Поиск по меню..." />
</div>

<main id="menu">
  <!-- Категории меню появятся здесь динамически -->
</main>

<div id="order-summary">
  <ul id="order-items"></ul>
  <div id="order-total">Итого: 0 ₽</div>
  <button id="clear-order">Очистить заказ</button>
  <button id="submit-order">Оформить заказ</button>
</div>

<!-- Модальное окно для ввода данных покупателя -->
<div id="modal">
  <div id="modal-content">
    <h3>Оформление заказа</h3>
    <input type="text" id="customer-name" placeholder="Ваше имя" />
    <input type="tel" id="customer-phone" placeholder="Телефон" pattern="[0-9+ -]{7,}" />
    <div id="modal-buttons">
      <button id="modal-submit">Отправить</button>
      <button id="modal-cancel">Отмена</button>
    </div>
  </div>
</div>

<script>
  // Меню по категориям (исправлены запятые и ключ desserts)
  const menuData = {
    kitchen: [
      {id: 1, name: "Пельмени", price: 350, image: "https://i.postimg.cc/fRPSYZHH/image.jpg"},
      {id: 2, name: "Борщ", price: 280, image: "https://i.postimg.cc/xT8W1vVX/image.jpg"},
      {id: 3, name: "Голубцы", price: 390, image: "https://i.postimg.cc/BtCHHZM1/image.jpg"}
    ],
    desserts: [
      {id: 4, name: "Чизкейк", price: 250, image: "https://i.postimg.cc/DyHDF4pm/image.jpg"},
      {id: 5, name: "Мороженое", price: 120, image: "https://i.postimg.cc/yYGtjHxn/image.jpg"}
    ],
    bar: [
      {id: 6, name: "Капучино", price: 150, image: "https://i.postimg.cc/bwD3vVbt/image.jpg"},
      {id: 7, name: "Латте", price: 170, image: "https://i.postimg.cc/RF9RXMY7/image.jpg"},
      {id: 8, name: "Кола 0,5", price: 120, image: "https://i.postimg.cc/yYqFP6Sk/image.jpg"},
      {id: 9, name: "RedBull 0,5", price: 180, image: "https://i.postimg.cc/0ynDPpXw/image.jpg"}
    ]
  };

  // Отображаемые имена категорий на русском
  const categoryNames = {
    kitchen: "Кухня",
    desserts: "Десерты",
    bar: "Бар"
  };

  const menuContainer = document.getElementById('menu');
  const searchInput = document.getElementById('search-input');

  // Заказ: объект, где ключ — id товара, значение — объект {item, quantity}
  let order = {};

  // Создаем и возвращаем DOM элемент для одного блюда
  function createMenuItem(item) {
    const itemEl = document.createElement('li');
    itemEl.className = 'menu-item';

    itemEl.innerHTML = `
      <img src="${item.image}" alt="${item.name}" loading="lazy" />
      <div class="menu-info">
        <div class="menu-name">${item.name}</div>
        <div class="menu-price">${item.price} ₽</div>
      </div>
      <div class="menu-controls">
        <input type="number" min="1" step="1" value="1" aria-label="Количество ${item.name}" />
        <button>Добавить</button>
      </div>
    `;

    const quantityInput = itemEl.querySelector('input[type="number"]');
    const addButton = itemEl.querySelector('button');

    addButton.addEventListener('click', () => {
      let qty = parseInt(quantityInput.value);
      if (isNaN(qty) || qty < 1) {
        alert("Пожалуйста, введите корректное количество (1 или больше).");
        quantityInput.value = 1;
        return;
      }
      addToOrder(item, qty);
      quantityInput.value = 1;
    });

    return itemEl;
  }

  // Создаем категорию с заголовком и списком блюд
  function createCategory(name, items) {
    const categoryEl = document.createElement('section');
    categoryEl.className = 'category';
    categoryEl.dataset.category = name;

    const header = document.createElement('div');
    header.className = `category-header ${name}`;
    header.tabIndex = 0; // чтобы можно было клавишей переключать
    header.setAttribute('role', 'button');
    header.setAttribute('aria-expanded', 'true');
    header.textContent = categoryNames[name] || name;

    const toggleIcon = document.createElement('span');
    toggleIcon.className = 'toggle-icon';
    toggleIcon.textContent = '▼';
    header.appendChild(toggleIcon);

    const itemsList = document.createElement('ul');
    itemsList.className = 'category-items';

    items.forEach(item => {
      itemsList.appendChild(createMenuItem(item));
    });

    header.addEventListener('click', () => {
      const isCollapsed = categoryEl.classList.toggle('collapsed');
      header.setAttribute('aria-expanded', !isCollapsed);
    });
    header.addEventListener('keydown', (e) => {
      if (e.key === "Enter" || e.key === " " ) {
        e.preventDefault();
        header.click();
      }
    });

    categoryEl.appendChild(header);
    categoryEl.appendChild(itemsList);

    return categoryEl;
  }

  // Отрисовываем меню по категориям
  function renderMenu(data) {
    menuContainer.innerHTML = '';
    for (const category in data) {
      if (data.hasOwnProperty(category)) {
        menuContainer.appendChild(createCategory(category, data[category]));
      }
    }
  }

  // Добавляем товар в заказ
  function addToOrder(item, quantity) {
    if (order[item.id]) {
      order[item.id].quantity += quantity;
    } else {
      order[item.id] = { item, quantity };
    }
    updateOrderSummary();
  }

  // Обновляем отображение заказа
  const orderSummary = document.getElementById('order-summary');
  const orderItemsList = document.getElementById('order-items');
  const orderTotalEl = document.getElementById('order-total');
  const clearOrderBtn = document.getElementById('clear-order');
  const submitOrderBtn = document.getElementById('submit-order');

  function updateOrderSummary() {
    const items = Object.values(order);
    if (items.length === 0) {
      orderSummary.style.display = 'none';
      return;
    }

    orderItemsList.innerHTML = '';
    let total = 0;
    items.forEach(({item, quantity}) => {
      const li = document.createElement('li');
      li.textContent = `${item.name} × ${quantity}`;
      const price = item.price * quantity;
      total += price;
      const priceSpan = document.createElement('span');
      priceSpan.textContent = `${price} ₽`;
      li.appendChild(priceSpan);
      orderItemsList.appendChild(li);
    });
    orderTotalEl.textContent = `Итого: ${total} ₽`;
    orderSummary.style.display = 'block';
  }

  clearOrderBtn.addEventListener('click', () => {
    if (confirm('Очистить весь заказ?')) {
      order = {};
      updateOrderSummary();
    }
  });

  // Поиск по меню
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.trim().toLowerCase();
    for (const category in menuData) {
      if (menuData.hasOwnProperty(category)) {
        const categorySection = menuContainer.querySelector(`section[data-category="${category}"]`);
        const itemsList = categorySection.querySelector('.category-items');
        const items = itemsList.children;

        let anyVisible = false;
        for (let i = 0; i < items.length; i++) {
          const name = items[i].querySelector('.menu-name').textContent.toLowerCase();
          if (name.includes(query)) {
            items[i].style.display = '';
            anyVisible = true;
          } else {
            items[i].style.display = 'none';
          }
        }
        // Скрываем категорию если нет совпадений
        categorySection.style.display = anyVisible ? '' : 'none';
      }
    }
  });

  // Модальное окно и отправка заказа
  const modal = document.getElementById('modal');
  const modalSubmitBtn = document.getElementById('modal-submit');
  const modalCancelBtn = document.getElementById('modal-cancel');
  const customerNameInput = document.getElementById('customer-name');
  const customerPhoneInput = document.getElementById('customer-phone');

  submitOrderBtn.addEventListener('click', () => {
    if (Object.keys(order).length === 0) {
      alert('Пожалуйста, добавьте товары в заказ перед оформлением.');
      return;
    }
    customerNameInput.value = '';
    customerPhoneInput.value = '';
    modal.style.display = 'flex';
    customerNameInput.focus();
  });

  modalCancelBtn.addEventListener('click', () => {
    modal.style.display = 'none';
  });

  modalSubmitBtn.addEventListener('click', () => {
    const name = customerNameInput.value.trim();
    const phone = customerPhoneInput.value.trim();

    if (name.length < 2) {
      alert('Пожалуйста, введите ваше имя.');
      customerNameInput.focus();
      return;
    }
    if (!phone.match(/^[0-9+ -]{7,}$/)) {
      alert('Пожалуйста, введите корректный телефон.');
      customerPhoneInput.focus();
      return;
    }

    sendOrder(name, phone);
    modal.style.display = 'none';
  });

  // Функция отправки заказа (пока просто вывод в консоль)
  function sendOrder(name, phone) {
    const items = Object.values(order).map(({item, quantity}) => ({
      name: item.name,
      price: item.price,
      quantity
    }));

    const total = items.reduce((acc, cur) => acc + cur.price * cur.quantity, 0);

    const orderData = {
      customer: { name, phone },
      items,
      total,
      date: new Date().toISOString()
    };

    console.log('Новый заказ:', orderData);

    alert(`Спасибо за заказ, ${name}!\nМы свяжемся с вами по телефону ${phone}.`);

    // После отправки очищаем заказ
    order = {};
    updateOrderSummary();
  }

  // Закрываем модал по клику вне содержимого
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  });

  // Инициализация
  renderMenu(menuData);
  updateOrderSummary();

</script>
</body>
</html>
