<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Кафе</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #fafafa; }
    header { background: #d35400; color: white; padding: 1rem; text-align: center; font-size: 1.5rem; }
    .tabs { display: flex; justify-content: center; background: #f3f3f3; }
    .tab-button { padding: 1rem; border: none; background: none; cursor: pointer; font-size: 1rem; transition: 0.3s; }
    .tab-button.active { color: #d35400; font-weight: bold; border-bottom: 2px solid #d35400; }
    #search-bar { display: flex; justify-content: center; padding: 0.5rem 1rem; background: #fff; }
    #search-input { width: 100%; max-width: 400px; padding: 0.5rem; font-size: 1rem; border-radius: 5px; border: 1px solid #ccc; }
    #menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; padding: 1rem; }
    .menu-item { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .menu-item img { width: 100%; height: 120px; object-fit: cover; }
    .menu-item div { padding: 0.5rem; }
    .menu-name { font-weight: bold; margin-bottom: 0.3rem; }
    .menu-controls { display: flex; gap: 0.5rem; align-items: center; margin-top: 0.5rem; }
    .menu-controls input { width: 40px; text-align: center; }
    .menu-controls button { padding: 0.3rem 0.7rem; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; }
    #order-summary { position: fixed; bottom: 0; width: 100%; background: white; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); padding: 1rem; display: none; }
    #order-summary ul { list-style: none; padding: 0; margin: 0 0 0.5rem 0; }
    #order-summary li { display: flex; justify-content: space-between; margin-bottom: 0.3rem; }
    #order-summary button { padding: 0.5rem 1rem; margin-right: 0.5rem; background: #c0392b; color: white; border: none; border-radius: 4px; cursor: pointer; }
    #submit-order { background: #2980b9; }
    #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    #modal-content { background: white; padding: 2rem; border-radius: 10px; width: 300px; text-align: center; }
    #modal-content input { width: 100%; padding: 0.5rem; margin: 0.5rem 0; }
    #modal-content button { padding: 0.5rem 1rem; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <header>Меню Кафе</header>
  <div class="tabs">
    <button class="tab-button active" data-category="bar">Бар</button>
    <button class="tab-button" data-category="kitchen">Кухня</button>
    <button class="tab-button" data-category="desserts">Десерты</button>
  </div>
  <div id="search-bar">
    <input type="text" id="search-input" placeholder="Поиск по меню..." />
  </div>
  <div id="menu"></div>

  <div id="order-summary">
    <ul id="order-items"></ul>
    <div id="order-total"></div>
    <div style="margin-top: 0.5rem;">
      <button id="clear-order">Очистить</button>
      <button id="submit-order">Оформить заказ</button>
    </div>
  </div>

  <div id="modal">
    <div id="modal-content">
      <h3>Ваши данные</h3>
      <input type="text" id="customer-name" placeholder="Имя">
      <input type="text" id="customer-phone" placeholder="Телефон">
      <button id="confirm-order">Подтвердить заказ</button>
    </div>
  </div>

  <script>
    const menu = [
      { id: 1, category: 'bar', name: 'Капучино', price: 150, image: 'https://i.postimg.cc/bwD3vVbt/image.jpg' },
      { id: 2, category: 'bar', name: 'Латте', price: 170, image: 'https://i.postimg.cc/RF9RXMY7/image.jpg' },
      { id: 3, category: 'kitchen', name: 'Цезарь', price: 350, image: 'https://i.postimg.cc/3xFCWMNW/image.jpg' },
      { id: 4, category: 'kitchen', name: 'Паста', price: 420, image: 'https://i.postimg.cc/CMnGkn53/image.jpg' },
      { id: 5, category: 'desserts', name: 'Чизкейк', price: 250, image: 'https://i.postimg.cc/MG00cCGv/image.jpg' },
      { id: 6, category: 'desserts', name: 'Мороженое', price: 150, image: 'https://i.imgur.com/ghi789.jpg' }
      { id: 7, category: 'bar', name: 'Кола 0,5', price: 120, image: 'https://i.postimg.cc/yYqFP6Sk/image.jpg' }
      { id: 8, category: 'bar', name: 'RedBull 0,5', price: 180, image: 'https://i.postimg.cc/0ynDPpXw/image.jpg' }
      { id: 9, category: 'kitchen', name: 'Шаурма', price: 210, image: 'https://i.postimg.cc/fLG0B5y6/image.webp' }
    ];

    const menuDiv = document.getElementById('menu');
    const buttons = document.querySelectorAll('.tab-button');
    const orderSummary = document.getElementById('order-summary');
    const orderItemsList = document.getElementById('order-items');
    const orderTotalDiv = document.getElementById('order-total');
    const clearOrderBtn = document.getElementById('clear-order');
    const submitOrderBtn = document.getElementById('submit-order');
    const confirmOrderBtn = document.getElementById('confirm-order');
    const searchInput = document.getElementById('search-input');

    let order = JSON.parse(localStorage.getItem('order')) || {};
    let currentCategory = 'bar';

    function saveOrder() {
      localStorage.setItem('order', JSON.stringify(order));
    }

    function updateOrderSummary() {
      const items = Object.values(order);
      if (items.length === 0) {
        orderSummary.style.display = 'none';
        return;
      }
      orderSummary.style.display = 'block';
      orderItemsList.innerHTML = '';
      let total = 0;
      items.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item.name} x${item.quantity}`;
        const priceSpan = document.createElement('span');
        priceSpan.textContent = `${item.price * item.quantity}₽`;
        li.appendChild(priceSpan);
        orderItemsList.appendChild(li);
        total += item.price * item.quantity;
      });
      orderTotalDiv.textContent = `Итого: ${total}₽`;
    }

    function renderMenu(category, search = '') {
      currentCategory = category;
      menuDiv.innerHTML = '';
      const filtered = menu.filter(item => item.category === category && item.name.toLowerCase().includes(search.toLowerCase()));
      filtered.forEach(item => {
        const div = document.createElement('div');
        div.className = 'menu-item';
        div.innerHTML = `
          <img src="${item.image}" alt="${item.name}" />
          <div>
            <div class="menu-name">${item.name}</div>
            <div>${item.price} ₽</div>
            <div class="menu-controls">
              <input type="number" value="1" min="1" />
              <button>Добавить</button>
            </div>
          </div>
        `;
        const qtyInput = div.querySelector('input');
        const addBtn = div.querySelector('button');
        addBtn.addEventListener('click', () => {
          const qty = parseInt(qtyInput.value);
          if (qty < 1) return;
          if (order[item.id]) {
            order[item.id].quantity += qty;
          } else {
            order[item.id] = {
              id: item.id,
              name: item.name,
              price: item.price,
              quantity: qty
            };
          }
          saveOrder();
          updateOrderSummary();
        });
        menuDiv.appendChild(div);
      });
    }

    buttons.forEach(button => {
      button.addEventListener('click', () => {
        buttons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        renderMenu(button.dataset.category, searchInput.value);
      });
    });

    searchInput.addEventListener('input', () => {
      renderMenu(currentCategory, searchInput.value);
    });

    clearOrderBtn.addEventListener('click', () => {
      if (confirm('Очистить заказ?')) {
        order = {};
        saveOrder();
        updateOrderSummary();
      }
    });

    submitOrderBtn.addEventListener('click', () => {
      if (Object.keys(order).length === 0) {
        alert("Сначала добавьте товары в заказ.");
        return;
      }
      document.getElementById('customer-name').value = localStorage.getItem('customerName') || '';
      document.getElementById('customer-phone').value = localStorage.getItem('customerPhone') || '';
      document.getElementById('modal').style.display = 'flex';
    });

    confirmOrderBtn.addEventListener('click', () => {
      const name = document.getElementById('customer-name').value.trim();
      const phone = document.getElementById('customer-phone').value.trim();

      if (!name || !phone) {
        alert("Пожалуйста, введите имя и телефон.");
        return;
      }

      localStorage.setItem('customerName', name);
      localStorage.setItem('customerPhone', phone);

      let orderText = `Новый заказ от ${name}, тел: ${phone}\n\n`;
      let total = 0;
      Object.values(order).forEach(item => {
        orderText += `${item.name} x${item.quantity} = ${item.price * item.quantity}₽\n`;
        total += item.price * item.quantity;
      });
      orderText += `\nИтого: ${total}₽`;

      alert(orderText); // Здесь можно сделать отправку в Telegram

      order = {};
      saveOrder();
      updateOrderSummary();
      document.getElementById('modal').style.display = 'none';
    });

    renderMenu('bar');
    updateOrderSummary();
  </script>
</body>
</html>
